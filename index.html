<!-- -->
<!-- -->
<!-- -->
<!-- -->
<!-- -->
<!-- -->
<!-- -->
<!-- -->
<!-- -->
<!-- -->
<!-- -->
<!-- -->
<!-- -->
<!---------------------------   ####     ##      ####             #######   ####     ####      ##      #### ----------------------------->
<!---------------------------  ##  ##   ####      ##                   ##  ##  ##     ##      ####    ##  ##----------------------------->
<!--------------------------- ##        ## ##     ##                  ##   ##   ##    ##      ## ##   ##   ##---------------------------->
<!---------------------------  #####   ##   ##    ##                 ##    ##   ##    ##     ##   ##  ##   ##---------------------------->
<!---------------------------      ##  #######    ##                ##     ##   ##    ##     #######  ##   ##---------------------------->
<!--------------------------- ##   ##  ##   ##    ##               ##      ##   ##    ##     ##   ##  ##   ##---------------------------->
<!---------------------------  #####   ##   ##   ####             #######   #####    ####    ##   ##   #####----------------------------->
<!-- -->
<!-- -->
<!-- -->
<!-- -->
<!-- -->
<!-- -->
<!-- -->
<!-- -->
<!-- -->
<!-- -->
<!-- -->
<!-- -->
<!-- -->



<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <title>Izao e Jhow</title>
    <link rel="icon" type="image/x-icon" href="images/nois.jpeg">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chá de Casa Nova</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&family=Dancing+Script:wght@700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="casanova.css">
</head>

<body>
    <header>
        <div class="header-content">
            <img src="images/nois.jpeg" alt="Nois" class="personal-photo">
            <div class="header-text">
                <h1>Chá de Casa Nova</h1>
                <p>Lista de Presentes</p>        
            </div>
        </div>

    </header>

    <main>
        <h5 style="text-align: center;font-size: 0.6em;">Clique e vincule os produtos que você deseja levar ao seu telefone!</h5>
        <section class="product-list">
            <div class="product-item" data-id="1">
                <img src="images/batedeira.png" alt="Batedeira Branca">
                <h2>Batedeira Branca</h2>
                <button class="link-button">Vincular</button>
            </div>

            <div class="product-item" data-id="2">
                <img src="images/liquidificador.png" alt="Liquidificador Branco">
                <h2>Liquidificador Branco</h2>
                <button class="link-button">Vincular</button>
            </div>

            <div class="product-item" data-id="1000">
                <img src="images/pote-2.png" alt="Pote de Bambu 250ml">
                <h2>Pote de Bambu 250ml</h2>
                <button class="link-button">Vincular</button>
            </div>

            <div class="product-item" data-id="3">
                <img src="images/multiprocessador.png" alt="Multiprocessador Branco">
                <h2>Multiprocessador Branco</h2>
                <button class="link-button">Vincular</button>
            </div>

            <div class="product-item" data-id="4">
                <img src="images/mixer.png" alt="Mixer Branco">
                <h2>Mixer Branco</h2>
                <button class="link-button">Vincular</button>
            </div>

            <div class="product-item" data-id="5">
                <img src="images/espremedor.png" alt="Espremedor Branco">
                <h2>Espremedor Branco</h2>
                <button class="link-button">Vincular</button>
            </div>

            <div class="product-item" data-id="6">
                <img src="images/assadeira.png" alt="Assadeira">
                <h2>Travessa de Forno</h2>
                <button class="link-button">Vincular</button>
            </div>

            <div class="product-item" data-id="7">
                <img src="images/forma-pudim.png" alt="Travessa Pudim de Forno">
                <h2>Travessa Pudim de Forno</h2>
                <button class="link-button">Vincular</button>
            </div>

            <div class="product-item" data-id="8">
                <img src="images/jarra.png" alt="Jarra de Vidro 2L">
                <h2>Jarra de Vidro 2L</h2>
                <button class="link-button">Vincular</button>
            </div>

            <div class="product-item" data-id="9">
                <img src="images/escorredor-macarrao.png" alt="Escorredor Macarrao">
                <h2>Escorredor Macarrao</h2>
                <button class="link-button">Vincular</button>
            </div>

            <div class="product-item" data-id="10">
                <img src="images/rodo.png" alt="Rodo Branco em Bambu">
                <h2>Rodo Branco em Bambu</h2>
                <button class="link-button">Vincular</button>
            </div>

            <div class="product-item" data-id="11">
                <img src="images/vassoura.png" alt="Vassoura e pá Branco em Bambu">
                <h2>Vassoura e pá Branco em Bambu</h2>
                <button class="link-button">Vincular</button>
            </div>

            <div class="product-item" data-id="12">
                <img src="images/rodinho.png" alt="Rodinho Branco em Bambu">
                <h2>Rodinho Branco em Bambu</h2>
                <button class="link-button">Vincular</button>
            </div>

            <div class="product-item" data-id="13">
                <img src="images/cesto.png" alt="Cesto em Bambu">
                <h2>Cesto em Bambu</h2>
                <button class="link-button">Vincular</button>
            </div>

            <div class="product-item" data-id="14">
                <img src="images/pote.png" alt="Pote de Bambu 1L">
                <h2>Pote de Bambu 1L</h2>
                <button class="link-button">Vincular</button>
            </div>

            <div class="product-item" data-id="15">
                <img src="images/gelo-redondo.png" alt="Forma de Gelo Redondo">
                <h2>Forma de Gelo Redondo</h2>
                <button class="link-button">Vincular</button>
            </div>

            <div class="product-item" data-id="16">
                <img src="images/gelo-quadrado.png" alt="Forma de Gelo Quadrado">
                <h2>Forma de Gelo Quadrado</h2>
                <button class="link-button">Vincular</button>
            </div>

            <div class="product-item" data-id="17">
                <img src="images/toalha-rosto.png" alt="Toalhas de Rosto Branco">
                <h2>Toalhas de Rosto Branco</h2>
                <button class="link-button">Vincular</button>
            </div>

            <div class="product-item" data-id="18">
                <img src="images/travesseiro.png" alt="2 Travesseiros Nasa">
                <h2>2 Travesseiros Nasa</h2>
                <button class="link-button">Vincular</button>
            </div>

            <div class="product-item" data-id="19">
                <img src="images/manta.png" alt="Manta Fleece Branca">
                <h2>Manta Fleece Branca</h2>
                <button class="link-button">Vincular</button>
            </div>

            <div class="product-item" data-id="20">
                <img src="images/assadeira-bolo.png" alt="Assadeira Bolo">
                <h2>Assadeira Bolo</h2>
                <button class="link-button">Vincular</button>
            </div>

            <div class="product-item" data-id="21">
                <img src="images/lixeira.png" alt="Lixeira Branca">
                <h2>Lixeira Branca 1</h2>
                <button class="link-button">Vincular</button>
            </div>

            <div class="product-item" data-id="22">
                <img src="images/lixeira.png" alt="Lixeira Branca">
                <h2>Lixeira Branca 2</h2>
                <button class="link-button">Vincular</button>
            </div>

            <div class="product-item" data-id="23">
                <img src="images/lixeira.png" alt="Lixeira Branca">
                <h2>Lixeira Branca 3</h2>
                <button class="link-button">Vincular</button>
            </div>
            <div class="product-item" data-id="24">
                <img src="images/abafador-para-cozinha.png" alt="Abafador para Cozinha">
                <h2>Abafador para Cozinha</h2>
                <button class="link-button">Vincular</button>
            </div>

            <div class="product-item" data-id="25">
                <img src="images/aspirador.png" alt="Aspirador">
                <h2>Aspirador Vertical Branco</h2>
                <button class="link-button">Vincular</button>
            </div>

            <div class="product-item" data-id="26">
                <img src="images/colher-sorvete.png" alt="Colher de Sorvete">
                <h2>Colher de Sorvete</h2>
                <button class="link-button">Vincular</button>
            </div>

            <div class="product-item" data-id="27">
                <img src="images/conchas.png" alt="Conchas">
                <h2>Conchas</h2>
                <button class="link-button">Vincular</button>
            </div>

            <div class="product-item" data-id="28">
                <img src="images/escorredor-arroz.png" alt="Escorredor de Arroz">
                <h2>Escorredor de Arroz Inox</h2>
                <button class="link-button">Vincular</button>
            </div>

            <div class="product-item" data-id="29">
                <img src="images/jogo-toalha.png" alt="Jogo de Toalha">
                <h2>Jogo de Toalha</h2>
                <button class="link-button">Vincular</button>
            </div>

            <div class="product-item" data-id="30">
                <img src="images/mantegueira.png" alt="Mantegueira">
                <h2>Mantegueira Francesa</h2>
                <button class="link-button">Vincular</button>
            </div>

            <div class="product-item" data-id="31">
                <img src="images/mopi.png" alt="Mopi">
                <h2>Mopi</h2>
                <button class="link-button">Vincular</button>
            </div>

            <div class="product-item" data-id="32">
                <img src="images/pegador-macarrao.png" alt="Pegador de Macarrão">
                <h2>Pegador de Macarrão</h2>
                <button class="link-button">Vincular</button>
            </div>

            <div class="product-item" data-id="33">
                <img src="images/toalha-azul-marinho.png" alt="Toalha Azul Marinho">
                <h2>Toalha Azul Marinho</h2>
                <button class="link-button">Vincular</button>
            </div>

            <div class="product-item" data-id="34">
                <img src="images/toalha-azul.png" alt="Toalha Azul">
                <h2>Toalha Azul</h2>
                <button class="link-button">Vincular</button>
            </div>

            <div class="product-item" data-id="35">
                <img src="images/toalha-branca.png" alt="Toalha Branca">
                <h2>Toalha Branca</h2>
                <button class="link-button">Vincular</button>
            </div>

            <div class="product-item" data-id="36">
                <img src="images/toalha-rosa.png" alt="Toalha Rosa">
                <h2>Toalha Rosa</h2>
                <button class="link-button">Vincular</button>
            </div>
            <div class="product-item" data-id="37">
                <img src="images/panos-de-prato.png" alt="Panos de prato">
                <h2>Panos de prato</h2>
                <button class="link-button">Vincular</button>
            </div>

            <div class="product-item" data-id="38">
                <img src="images/sanduicheira.png" alt="Sanduicheira Cadence Dream">
                <h2>Sanduicheira Cadence Dream</h2>
                <button class="link-button">Vincular</button>
            </div>

            <div class="product-item" data-id="39">
                <img src="images/kit-lavabo.png" alt="Kit Lavabo Rosé">
                <h2>Kit Lavabo Rosé 1</h2>
                <button class="link-button">Vincular</button>
            </div>

            <div class="product-item" data-id="40">
                <img src="images/kit-lavabo.png" alt="Kit Lavabo Rosé">
                <h2>Kit Lavabo Rosé 2</h2>
                <button class="link-button">Vincular</button>
            </div>

            <div class="product-item" data-id="41">
                <img src="images/kit-lavabo.png" alt="Kit Lavabo Rosé">
                <h2>Kit Lavabo Rosé 3</h2>
                <button class="link-button">Vincular</button>
            </div>
            <div class="product-item" data-id="42">
                <img src="images/jogo-lencol.png" alt="Jogo Lençol Branco">
                <h2>Jogo Lençol Branco</h2>
                <button class="link-button">Vincular</button>
            </div>
            <div class="product-item" data-id="43">
                <img src="images/jogo-lencol.png" alt="Jogo Lençol Branco">
                <h2>Jogo Lençol Branco</h2>
                <button class="link-button">Vincular</button>
            </div>
            <div class="product-item" data-id="44">
                <img src="images/jogo-lencol.png" alt="Jogo Lençol Branco">
                <h2>Jogo Lençol Branco</h2>
                <button class="link-button">Vincular</button>
            </div>
            <div class="product-item" data-id="45">
                <img src="images/jogo-lencol.png" alt="Jogo Lençol Branco">
                <h2>Jogo Lençol Branco</h2>
                <button class="link-button">Vincular</button>
            </div>
            <div class="product-item" data-id="46">
                <img src="images/luva.png" alt="Luva">
                <h2>Luva Termica</h2>
                <button class="link-button">Vincular</button>
            </div>
            <div class="product-item" data-id="47">
                <img src="images/garrafa-cafe.png" alt="Garrafa de Café Branca">
                <h2>Garrafa de Café Branca</h2>
                <button class="link-button">Vincular</button>
            </div>
            <div class="product-item" data-id="48">
                <img src="images/medidor.png" alt="Copo Medidor">
                <h2>Copo Medidor</h2>
                <button class="link-button">Vincular</button>
            </div>
            <div class="product-item" data-id="49">
                <img src="images/descanso-panela.png" alt="Descanso de Panela">
                <h2>Descanso de Panela</h2>
                <button class="link-button">Vincular</button>
            </div>
            <div class="product-item" data-id="50">
                <img src="images/colher-renascenca.png" alt="Colher de Mesa *Tramontina Renascença*">
                <h2>2 Colheres de Mesa *Tramontina Renascença*</h2>
                <button class="link-button">Vincular</button>
            </div>
            <div class="product-item" data-id="51">
                <img src="images/garfo-renascenca.png" alt="Garfo de Mesa *Tramontina Renascença*">
                <h2>2 Garfos de Mesa *Tramontina Renascença*</h2>
                <button class="link-button">Vincular</button>
            </div>
            <div class="product-item" data-id="52">
                <img src="images/faca-renascenca.png" alt="Faca de Mesa *Tramontina Renascença*">
                <h2>2 Facas de Mesa *Tramontina Renascença*</h2>
                <button class="link-button">Vincular</button>
            </div>
            <div class="product-item" data-id="53">
                <img src="images/colher-renascenca.png" alt="Colher de Mesa *Tramontina Renascença*">
                <h2>2 Colheres de Mesa *Tramontina Renascença*</h2>
                <button class="link-button">Vincular</button>
            </div>
            <div class="product-item" data-id="54">
                <img src="images/garfo-renascenca.png" alt="Garfo de Mesa *Tramontina Renascença*">
                <h2>2 Garfos de Mesa *Tramontina Renascença*</h2>
                <button class="link-button">Vincular</button>
            </div>
            <div class="product-item" data-id="55">
                <img src="images/faca-renascenca.png" alt="Faca de Mesa *Tramontina Renascença*">
                <h2>2 Facas de Mesa *Tramontina Renascença*</h2>
                <button class="link-button">Vincular</button>
            </div>
            <div class="product-item" data-id="56">
                <img src="images/colher-renascenca.png" alt="Colher de Mesa *Tramontina Renascença*">
                <h2>2 Colheres de Mesa *Tramontina Renascença*</h2>
                <button class="link-button">Vincular</button>
            </div>
            <div class="product-item" data-id="57">
                <img src="images/garfo-renascenca.png" alt="Garfo de Mesa *Tramontina Renascença*">
                <h2>2 Garfos de Mesa *Tramontina Renascença*</h2>
                <button class="link-button">Vincular</button>
            </div>
            <div class="product-item" data-id="58">
                <img src="images/faca-renascenca.png" alt="Faca de Mesa *Tramontina Renascença*">
                <h2>2 Facas de Mesa *Tramontina Renascença*</h2>
                <button class="link-button">Vincular</button>
            </div>
            <div class="product-item" data-id="59">
                <img src="images/colher-renascenca.png" alt="Colher de Mesa *Tramontina Renascença*">
                <h2>2 Colheres de Mesa *Tramontina Renascença*</h2>
                <button class="link-button">Vincular</button>
            </div>
            <div class="product-item" data-id="60">
                <img src="images/garfo-renascenca.png" alt="Garfo de Mesa *Tramontina Renascença*">
                <h2>2 Garfos de Mesa *Tramontina Renascença*</h2>
                <button class="link-button">Vincular</button>
            </div>
            <div class="product-item" data-id="61">
                <img src="images/faca-renascenca.png" alt="Faca de Mesa *Tramontina Renascença*">
                <h2>2 Facas de Mesa *Tramontina Renascença*</h2>
                <button class="link-button">Vincular</button>
            </div>
            <div class="product-item" data-id="62">
                <img src="images/colher-renascenca.png" alt="Colher de Mesa *Tramontina Renascença*">
                <h2>2 Colheres de Mesa *Tramontina Renascença*</h2>
                <button class="link-button">Vincular</button>
            </div>
            <div class="product-item" data-id="63">
                <img src="images/garfo-renascenca.png" alt="Garfo de Mesa *Tramontina Renascença*">
                <h2>2 Garfos de Mesa *Tramontina Renascença*</h2>
                <button class="link-button">Vincular</button>
            </div>
            <div class="product-item" data-id="64">
                <img src="images/faca-renascenca.png" alt="Faca de Mesa *Tramontina Renascença*">
                <h2>2 Facas de Mesa *Tramontina Renascença*</h2>
                <button class="link-button">Vincular</button>
            </div>
            <div class="product-item" data-id="65">
                <img src="images/colher-renascenca.png" alt="Colher de Mesa *Tramontina Renascença*">
                <h2>2 Colheres de Mesa *Tramontina Renascença*</h2>
                <button class="link-button">Vincular</button>
            </div>
            <div class="product-item" data-id="66">
                <img src="images/garfo-renascenca.png" alt="Garfo de Mesa *Tramontina Renascença*">
                <h2>2 Garfos de Mesa *Tramontina Renascença*</h2>
                <button class="link-button">Vincular</button>
            </div>
            <div class="product-item" data-id="67">
                <img src="images/faca-renascenca.png" alt="Faca de Mesa *Tramontina Renascença*">
                <h2>2 Facas de Mesa *Tramontina Renascença*</h2>
                <button class="link-button">Vincular</button>
            </div>
        </section>
    </main>

    <footer>
        <div class="footer-block-1">
            <p>Obrigada pela presença e carinho! 💕</p>
        </div>
        <div class="footer-block-2">
            <button id="desvincular-button">Desvincular Produto</button>
        </div>      
    </footer>

    <div id="vincular-modal" class="modal" style="display:none;">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2>Vincular Produto</h2>
            <center><input type="text" id="telefone" name="telefone" placeholder="Digite seu telefone" required></center>
            <button id="confirm-vincular">Vincular</button>
        </div>
    </div>
    <div id="desvincular-modal" style="display:none;">
        <div class="modal-content">
            <button class="close-button">&times;</button>
            <h2>Desvincular Produtos</h2>
            <h5>Todos os produtos vinculados ao seu telefone irão ser removidos!</h5>
            <center><input type="text" id="desvincular-telefone" placeholder="Digite seu telefone"></center>
            <button id="confirm-desvincular">Desvincular</button>
        </div>
    </div>
    <script>
        document.addEventListener("DOMContentLoaded", async function () {
            await applyProductData();

            const modal = document.getElementById('vincular-modal');
            const closeButton = document.querySelector('.close-button');
            const confirmButton = document.getElementById('confirm-vincular');
            const telefoneInput = document.getElementById('telefone');
            let selectedProduct = null;

            const desvincularButton = document.getElementById('desvincular-button');
            const desvincularModal = document.getElementById('desvincular-modal');
            const desvincularCloseButton = desvincularModal.querySelector('.close-button');
            const desvincularConfirmButton = document.getElementById('confirm-desvincular');
            const desvincularTelefoneInput = document.getElementById('desvincular-telefone');

            document.querySelectorAll('.link-button').forEach(button => {
                button.addEventListener('click', function () {
                    selectedProduct = parseInt(this.closest('.product-item').getAttribute('data-id'));
                    modal.style.display = 'block';
                });
                button.addEventListener('touchend', function () {
                    selectedProduct = parseInt(this.closest('.product-item').getAttribute('data-id'));
                    modal.style.display = 'block';
                });
            });

            closeButton.addEventListener('click', function () {
                modal.style.display = 'none';
                telefoneInput.value = '';
            });

            telefoneInput.addEventListener('input', function () {
                const telefone = telefoneInput.value;
                telefoneInput.value = telefone.replace(/[^\d()-]/g, '').replace(/^(\d{2})(\d)/g, '($1)$2').replace(/(\d{5})(\d)/, '$1-$2').slice(0, 14);

                if (telefoneInput.value.length < 8) {
                    telefoneInput.setCustomValidity("O telefone deve ter pelo menos 8 dígitos.");
                } else {
                    telefoneInput.setCustomValidity("");
                }
            });

            confirmButton.addEventListener('click', async function () {
                const telefone = telefoneInput.value.replace(/[^0-9]/g, '');;

                if (telefone.length > 7 && telefone.length <= 11) {

                    const products = await loadProductData();
                    let product = products.find(p => p.Id === selectedProduct);
                    if (product && product.Vinculado) {
                        modal.style.display = 'none';
                        alert("Produto já vinculado.");
                    }
                    else {
                        product = {};
                        product.Id = selectedProduct;
                        product.Telefone = telefone;
                        product.Vinculado = true;

                        var response = await saveProductData(product);
                        modal.style.display = 'none';
                        if (!response || response.status > 299) {
                            alert("Não foi possivel vincular.");
                        }
                        else {
                            alert("Vinculado com sucesso!");
                            await applyProductData();
                        }
                    }

                } else {
                    alert("Por favor, insira um telefone válido com 7 a 11 dígitos.");
                }
                telefoneInput.value = '';
            });

            desvincularTelefoneInput.addEventListener('input', function () {
                const telefone = desvincularTelefoneInput.value;

                desvincularTelefoneInput.value = telefone.replace(/[^\d()-]/g, '').replace(/^(\d{2})(\d)/g, '($1)$2').replace(/(\d{5})(\d)/, '$1-$2').slice(0, 14);

                if (desvincularTelefoneInput.value.length < 8) {
                    desvincularTelefoneInput.setCustomValidity("O telefone deve ter pelo menos 8 dígitos.");
                } else {
                    desvincularTelefoneInput.setCustomValidity("");
                }
            });

            desvincularButton.addEventListener('click', function () {
                desvincularModal.style.display = 'block';
            });

            desvincularCloseButton.addEventListener('click', function () {
                desvincularModal.style.display = 'none';
                desvincularTelefoneInput.value = '';
            });

            desvincularConfirmButton.addEventListener('click', async function () {
                const telefone = desvincularTelefoneInput.value.replace(/[^0-9]/g, '');;

                if (telefone.length > 7 && telefone.length <= 11) {
                    const products = await loadProductData();
                    const product = products.find(p => p.Telefone === telefone);
                    if (product && product.Vinculado) {
                        var response = await deleteProductData(telefone);
                        modal.style.display = 'none';
                        if (!response || response.status > 299) {
                            alert("Não foi possivel desvincular.");
                        }
                        else {
                            alert("Desvinculado com sucesso!");
                        }
                    }
                    else {
                        alert("Nenhum produto encontrado para o telefone informado.");
                    }

                } else {
                    alert("Por favor, insira um telefone válido com 7 a 11 dígitos.");
                }
                await applyProductData();
                desvincularTelefoneInput.value = '';
            });

            window.addEventListener('click', function (event) {
                if (event.target === modal) {
                    modal.style.display = 'none';
                    telefoneInput.value = '';
                }

                if (event.target === desvincularModal) {
                    desvincularModal.style.display = 'none';
                    desvincularTelefoneInput.value = '';
                }
            });

            async function loadProductData() {
                const response = await fetch('https://api.izaoejhow.com.br/api/products')
                return response.json();
            }

            async function saveProductData(data) {
                const response = await fetch('https://api.izaoejhow.com.br/api/products', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                return response;
            }

            async function deleteProductData(tel) {
                const response = await fetch(`https://api.izaoejhow.com.br/api/products?telefone=${tel}`, { method: 'DELETE' });

                return response;
            }

            async function applyProductData() {
                const products = await loadProductData();
                document.querySelectorAll('.product-item').forEach(item => {
                    const productId = parseInt(item.getAttribute('data-id'));
                    const product = products.find(p => p.Id === productId);

                    if (product && product.Vinculado) {
                        item.classList.add('vinculado');
                    } else {
                        item.classList.remove('vinculado');
                    }
                });
            }
        });
    </script>
</body>
</html>